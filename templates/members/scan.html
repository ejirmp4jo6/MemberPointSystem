{% extends "base.html" %}
{% block title %}店員累點{% endblock %}
{% block content %}
{% load static %}

<div class="cardish">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">店員累點</h5>
    <span class="badge-soft">只限店員</span>
  </div>

  <!-- 掃描區 -->
  <div id="qr-box" class="mb-3" style="display:block;">
    <div id="qr-reader" style="width:100%; max-width:480px; margin:0 auto;"></div>
  </div>

  <div id="bc-box" class="mb-3" style="display:none;">
    <div id="bc-reader" style="width:100%; max-width:480px; margin:0 auto; background:#000; color:#fff; border-radius:8px;">
      <div class="p-2 text-center">相機啟動中…若無畫面請切到背面鏡頭</div>
      <canvas class="w-100" id="bc-canvas"></canvas>
    </div>
    <div class="d-flex gap-2 justify-content-center mt-2">
      <button class="btn btn-sm btn-outline-secondary" id="bc-swap">切換鏡頭</button>
    </div>
  </div>

  <!-- 表單 -->
  <form method="post" action="{% url 'earn_points' %}" class="row g-3">
    {% csrf_token %}
    <div class="col-12">
      <label class="form-label">會員 QRCode</label>
      <div class="input-group">
        <input name="barcode_token" id="token-input" class="form-control" placeholder="掃描或貼上 QRCode" required>
        <button class="btn btn-outline-secondary" type="button" id="open-scanner" aria-label="開啟相機掃描">
          <i class="bi bi-camera"></i>
        </button>
      </div>
      <div class="form-text">點右邊相機圖示即可開啟鏡頭掃描。</div>
    </div>

    <div class="col-6">
      <label class="form-label">消費金額（TWD）</label>
      <input name="amount_twd" id="amount-input" type="number" min="0" step="1" class="form-control" required>
    </div>
    <div class="col-12">
      <label class="form-label">備註（可選）</label>
      <input name="note" class="form-control" placeholder="例如：外帶咖啡兩杯">
    </div>
    <div class="col-12 d-flex gap-2">
      <button class="btn btn-brand text-white">送出累點</button>
      <a class="btn btn-outline-secondary" href="{% url 'scan_page' %}">清空重掃</a>
    </div>
  </form>
</div>

<script src="{% static 'js/scan.js' %}"></script>

{% endblock %}
